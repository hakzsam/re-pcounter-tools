.. _nv50-gpu-hw-events-config:

======================================
NV50 GPU Hardware events configuration
======================================

.. contents::

NV50 enables muxs on TPC[0x3]!

GPU signals
===========

+-----------------------+----------+-----------------+
|                       |   CTRL   |      EVENT      |
+-------------------+---+----------+----------+------+
| signal            |SET| CTR_MODE |    SRC   |  OP  |
+===================+===+==========+==========+======+
| gpu_busy/gpu_idle | 1 |  SIMPLE  |0xeeeeeec8|0xaaaa|
+-------------------+---+----------+----------+------+

IA signals
==========

+----------------------------------+----------+-----------------+----------+
|                                  |   CTRL   |      EVENT      |    MUX   |
+------------------------------+---+----------+----------+------+----------+
| signal                       |SET| CTR_MODE |    SRC   |  OP  | 0x400c0c |
+==============================+===+==========+==========+======+==========+
| input_assembler_busy         | 1 |  SIMPLE  |0x28293d3e|0xf888|0x00000001|
+------------------------------+---+----------+----------+------+----------+
| input_assembler_waits_for_fb | 1 |  SIMPLE  |0xeeeeee34|0xaaaa|0x00000001|
+------------------------------+---+----------+----------+------+----------+
| vertex_attribute_count       | 1 |  SIMPLE  |0x28293d3e|0xf888|0x00000001|
+------------------------------+---+----------+----------+------+----------+

GEOM signals
============

The geom_waits_for_shader signal depends of MP counters.

+------------------------------+----------+-----------------+-----------------+----------------------+----------+
|                              |   CTRL   |      START      |      EVENT      |         MPC          |   MUX    |
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+
| signal                   |SET| CTR_MODE |    SRC   |  OP  |    SRC   |  OP  | PM_GROUP_SEL | UNK40 | 0x400c0c |
+==========================+===+==========+==========+======+==========+======+==============+=======+==========+
| geom_busy                | 3 |  SIMPLE  |    N/A   | N/A  |0x03020100|0xf888|     0x3      |  0x1  |    N/A   |
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+
| geom_waits_for_shader    | 3 |  SIMPLE  |    N/A   | N/A  |0x03020100|0x22f2|     0x3      |  0x1  |    N/A   |
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+
| geom_vertex_in_count     | 1 | EVENT_B4 |0xee363534|0xffff|0xeeeeeeee|0x5555|     N/A      |  N/A  |0x00000000|
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+
| geom_primitive_in_count  | 1 |  SIMPLE  |    N/A   | N/A  |0xeeeeee2e|0xaaaa|     N/A      |  N/A  |0x00000001|
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+
| geom_vertex_out_count    | 1 |  SIMPLE  |    N/A   | N/A  |0xeeeeee7d|0xaaaa|     N/A      |  N/A  |    N/A   |
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+
| geom_primitive_out_count | 1 |  SIMPLE  |    N/A   | N/A  |0xeeeeee7c|0xaaaa|     N/A      |  N/A  |    N/A   |
+--------------------------+---+----------+----------+------+----------+------+--------------+-------+----------+

SO signals
==========

+---------------------+----------+-----------------+
|                     |   CTRL   |      EVENT      |
+-----------------+---+----------+----------+------+
| signal          |SET| CTR_MODE |    SRC   |  OP  |
+=================+===+==========+==========+======+
| stream_out_busy | 1 |  SIMPLE  |0xeeee807f|0x8888|
+-----------------+---+----------+----------+------+

SETUP signals
=============

+----------------------------------+----------+-----------------+
|                                  |   CTRL   |      EVENT      |
+------------------------------+---+----------+----------+------+
| signal                       |SET| CTR_MODE |    SRC   |  OP  |
+==============================+===+==========+==========+======+
| setup_primitive_count        | 1 |  SIMPLE  |0xeeeeeedc|0xaaaa|
+------------------------------+---+----------+----------+------+
| setup_point_count            | 1 |  SIMPLE  |0xeee3e2dd|0x8080|
+------------------------------+---+----------+----------+------+
| setup_line_count             | 1 |  SIMPLE  |0xeee3e2de|0x8080|
+------------------------------+---+----------+----------+------+
| setup_triangle_count         | 1 |  SIMPLE  |0xeee3e2df|0x8080|
+------------------------------+---+----------+----------+------+
| setup_primitive_culled_count | 1 |  SIMPLE  |0xeeeeeeae|0xaaaa|
+------------------------------+---+----------+----------+------+

VS signals
==========

.. _vs-todo:
TODO
----

- vertex_shader_busy
- vertex_shader_instruction_rate

GS signals
==========

.. _gs-todo:
TODO
----

- geometry_shader_busy
- geometry_shader_instruction_rate

PS signals
==========

.. _ps-todo:
TODO
----

- pixel_shader_busy
- pixel_shader_instruction_rate

SHADER signals
==============

The shader_busy, shader_waits_for_geom and shader_waits_for_rop signals depends
of MP counters.

+------------------------------+----------+-----------------+----------------------+
|                              |   CTRL   |      EVENT      |         MPC          |
+--------------------------+---+----------+----------+------+--------------+-------+
| signal                   |SET| CTR_MODE |    SRC   |  OP  | PM_GROUP_SEL | UNK40 |
+==========================+===+==========+==========+======+==============+=======+
| shader_busy              | 3 |  SIMPLE  |0x2e2e0400|0xeeee|     0x100    |  0x1  |
+--------------------------+---+----------+----------+------+--------------+-------+
| shader_waits_for_texture | 3 |  SIMPLE  |0x01000302|0x22f2|     0x10     |  0x1  |
+--------------------------+---+----------+----------+------+--------------+-------+
| shader_waits_for_geom    | 3 |  SIMPLE  |0x03020100|0x22f2|     0x4      |  0x1  |
+--------------------------+---+----------+----------+------+--------------+-------+
| shader_waits_for_rop     | 3 |  SIMPLE  |0x2e2e0100|0x2222|     0x5      |  0x1  |
+--------------------------+---+----------+----------+------+--------------+-------+

RASTER signals
==============

+--------------------------------------------+----------+----------+------+----------+------+----------+----------+
|                                            |   CTRL   |      START      |      EVENT      |   MUX    |    MUX   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+
| signal                                 |SET| CTR_MODE |    SRC   |  OP  |    SRC   |  OP  | 0x40be50 | 0x402ca4 |
+========================================+===+==========+==========+======+==========+======+==========+==========+
| shaded_pixel_count_0                   | 2 |  SIMPLE  |    N/A   | N/A  |0xeeee0607|0x8888|0x80000016|    N/A   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+
| shaded_pixel_count_1                   | 2 | EVENT_B6 |0x03020100|0xffff|0x0504ee07|0xffff|0x80000016|    N/A   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+
| rasterizer_tiles_killed_by_zcull_count | 1 | EVENT_B6 |0x23222120|0xffff|0x2524eeee|0xffff|    N/A   |    0x7   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+
| rasterizer_tiles_in_count              | 1 | EVENT_B6 |0x23222120|0xffff|0x2524eeee|0xffff|    N/A   |    0x0   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+
| rasterizer_pixels_out_count_0          | 2 |  SIMPLE  |    N/A   | N/A  |0xeeee0607|0x8888|0x80000016|    N/A   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+
| rasterizer_pixels_out_count_1          | 2 | EVENT_B6 |0x03020100|0xffff|0x0504ee07|0xffff|0x80000016|    N/A   |
+----------------------------------------+---+----------+----------+------+----------+------+----------+----------+

ROP signals
===========

+----------------------------------------+----------+-----------------+-----------------+----------+----------+----------+
|                                        |   CTRL   |      START      |      EVENT      |   MUX    |   MUX    |   MUX    |
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| signal                             |SET| CTR_MODE |    SRC   |  OP  |    SRC   |  OP  | 0x40be50 | 0x407008 | 0x40708c |
+====================================+===+==========+==========+======+==========+======+==========+==========+==========+
| rop_busy                           | 2 |  SIMPLE  |    N/A   | N/A  |0x05040302|0xf888|0x80000000|    N/A   |    N/A   |
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| rop_waits_for_fb                   | 2 |  SIMPLE  |    N/A   | N/A  |0x6e6f5455|0x22f2|    N/A   |0x80000001|0x80000001|
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| rop_waits_for_shader               | 2 |  SIMPLE  |    N/A   | N/A  |0xeeee0706|0x2222|0x80000000|    N/A   |    N/A   |
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| rop_samples_killed_by_earlyz_count | 2 | EVENT_B6 |0x03020100|0xffff|0x0504ee07|0xaaaa|0x8000001a|    N/A   |    N/A   |
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| rop_samples_killed_by_latez_count  | 2 | EVENT_B6 |0x03020100|0xffff|0x0504ee07|0xaaaa|0x8000001b|    N/A   |    N/A   |
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| rop_samples_in_count_0             | 2 |  SIMPLE  |    N/A   | N/A  |0xeeee0607|0x8888|0x80000015|    N/A   |    N/A   |
+------------------------------------+---+----------+----------+------+----------+------+----------+----------+----------+
| rop_samples_in_count_1             | 2 | EVENT_B6 |0x03020100|0xffff|0x0504ee07|0xaaaa|0x80000015|    N/A   |    N/A   |
+------------------------------------+---+----------+-----------------+----------+------+----------+----------+----------+


TEXTURE signals
===============

+--------------------------------------+----------+-----------------+----------------------+----------+
|                                      |   CTRL   |      EVENT      |         MPC          |   MUX    |
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| signal                           |SET| CTR_MODE |    SRC   |  OP  | PM_GROUP_SEL | UNK34 | 0x40b808 |
+==================================+===+==========+==========+======+==============+=======+==========+
| texture_busy                     | 3 |  SIMPLE  |0x2e050402|0xeaea|     0x1110   |  0x1  |    N/A   |
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| texture_waits_for_fb             | 2 |  SIMPLE  |0xeeeeee42|0xaaaa|      N/A     |  N/A  |set bit 11|
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| texture_waits_for_shader         | 3 |  SIMPLE  |0x2c2c0100|0x2222|      0x11    |  0x1  |    N/A   |
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| texture_sample_base_level_rate_0 | 2 |  SIMPLE  |0x73727170|0x7fff|      N/A     |  N/A  |set bit 11|
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| texture_sample_base_level_rate_1 | 2 |  SIMPLE  |0x73727170|0x0001|      N/A     |  N/A  |set bit 11|
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| texture_sample_average_level_0   | 2 |  SIMPLE  |0x73727170|0x7fff|      N/A     |  N/A  |set bit 11|
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
| texture_sample_average_level_1   | 2 |  SIMPLE  |0x73727170|0x0001|      N/A     |  N/A  |set bit 11|
+----------------------------------+---+----------+----------+------+--------------+-------+----------+
